package send_command_thread;
import com.jcraft.jsch.*;
import org.apache.commons.io.IOUtils;

import java.io.InputStream;
import java.io.OutputStream;
import java.io.StringWriter;
public class executeThread {
	public executeThread() {
		// this.SFTPHOST = "10.35.204.56";
        this.SFTPPORT = 22;
        this.SFTPUSER = "centos";
        // this file can be id_rsa or id_dsa based on which algorithm is used to create the key
        this.privateKey = "D:\\denys_key.pem";
        this.SFTPWORKINGDIR = "/home/centos/";
	}
	private String SFTPHOST;
    private int SFTPPORT;
    private String SFTPUSER;
    private String privateKey;
    private String SFTPWORKINGDIR;
    private Channel channel = null;
    
    public void CreateConnection() {
    	JSch jSch = new JSch();
        Session session = null;
       
        ChannelSftp channelSftp = null;
        
        String result=" ";
        try {
        jSch.addIdentity(privateKey);
        System.out.println("Private Key Added.");
        session = jSch.getSession(SFTPUSER, SFTPHOST, SFTPPORT);
        System.out.println("session created.");

        java.util.Properties config = new java.util.Properties();
        config.put("StrictHostKeyChecking", "no");
        session.setConfig(config);
        session.connect();


        channel = session.openChannel("exec");

        channel.setInputStream(null);
        }catch(Exception e){
            System.out.println(e);
        }
    }
        
     public void StartCommand(String command){
    	 (ChannelExec)channel).setCommand("sudo -S -p '' "+ command);
         ((ChannelExec)channel).setErrStream(System.err);
         InputStream in=channel.getInputStream();
         OutputStream out=channel.getOutputStream();
         ((ChannelExec)channel).setPty(true);
         channel.connect();
         String sudo_pass="Alstom$123";
         out.write((sudo_pass+"\n").getBytes());
         out.flush();
         out.close();

         StringWriter writer = new StringWriter();
         IOUtils.copy(in, writer);
         String theString = writer.toString();
         result=theString;
     }    }

}
